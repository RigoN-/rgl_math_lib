<html><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1251"><title>www.ПЕРВЫЕ ШАГИ.ru :: Шаг 5 - Создание статической библиотеки</title><link rel="stylesheet" type="text/css" href="www.%D0%9F%D0%95%D0%A0%D0%92%D0%AB%D0%95%20%D0%A8%D0%90%D0%93%D0%98.ru%20::%20%D0%A8%D0%B0%D0%B3%205%20-%20%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5%20%D1%81%D1%82%D0%B0%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%BE%D0%B9%20%D0%B1%D0%B8%D0%B1%D0%BB%D0%B8%D0%BE%D1%82%D0%B5%D0%BA%D0%B8_files/2.css"></head><body alink="red" bgcolor="white" link="blue" text="black" vlink="blue"><h2>Шаг 5 - Создание статической библиотеки</h2><table align="center" border="0"><tbody><tr><td>
<script type="text/javascript"><!--
google_ad_client = "pub-2721325097469880";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_type = "text_image";
//2007-06-25: Основной
google_ad_channel = "4805213305";
//-->
</script>
<script type="text/javascript" src="www.%D0%9F%D0%95%D0%A0%D0%92%D0%AB%D0%95%20%D0%A8%D0%90%D0%93%D0%98.ru%20::%20%D0%A8%D0%B0%D0%B3%205%20-%20%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5%20%D1%81%D1%82%D0%B0%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%BE%D0%B9%20%D0%B1%D0%B8%D0%B1%D0%BB%D0%B8%D0%BE%D1%82%D0%B5%D0%BA%D0%B8_files/show_ads.js">
</script>
</td></tr></tbody></table>

<script language="JavaScript"><!--
d=document;js=10;a=';r='+escape(d.referrer)
//--></script><script language="JavaScript1.1"><!--
js=11;a+=';j='+navigator.javaEnabled()
//--></script><script language="JavaScript1.2"><!--
js=12;s=screen;a+=';s='+s.width+'*'+s.height
a+=';d='+(s.colorDepth?s.colorDepth:s.pixelDepth)
//--></script><script language="JavaScript1.3"><!--
js=13//--></script><script language="JavaScript"><!--
d.write('<iframe src="http://top.list.ru/counter'+
'?id=23099;js='+js+a+'" height=1 width=1 border=0></iframe>')
if(js>11)d.write('<'+'!-- ')//--></script><iframe src="www.%D0%9F%D0%95%D0%A0%D0%92%D0%AB%D0%95%20%D0%A8%D0%90%D0%93%D0%98.ru%20::%20%D0%A8%D0%B0%D0%B3%205%20-%20%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5%20%D1%81%D1%82%D0%B0%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%BE%D0%B9%20%D0%B1%D0%B8%D0%B1%D0%BB%D0%B8%D0%BE%D1%82%D0%B5%D0%BA%D0%B8_files/counter_002.gif" border="0" height="1" width="1"></iframe><!-- <noscript><iframe
src="http://top.list.ru/counter?js=na;id=23099"
height=1 width=1 alt=""></iframe></noscript><script language="JavaScript"><!--
if(js>11)d.write('--'+'>')
//-->

<div style="margin:10px;"><p>Для создания статических библиотек существует специальная простая программа называемая <b>ar</b> (сокр. от <b>archiver</b>
 - архиватор). Она используется для создания, модификации и просмотра 
объектных файлов в статических библиотеках, которые в действительности 
представляют из себя простые архивы.
</p><p>Давайте вернемся к проекту из шага <a href="http://www.firststeps.ru/linux/r.php?3">"Шаг 3 - Компиляция нескольких файлов"</a> и создадим из файлов <b>f1.c</b> и <b>f2.c</b> отдельную библиотеку. Для начала компилируем эти файлы:
</p><pre>dron:~# gcc -c f1.c f2.c
</pre>
<p>В результате получим, как обычно, два файла - <b>f1.o</b> и  <b>f2.o</b>. Для того, чтобы создать библиотеку из объектых файлов надо вызвать программу <b>ar</b> со следующими параметрами:
</p><pre>ar rc lib<i>имя_библиотеки</i>.a <i>[список_*.o_файлов]</i>
</pre>
<p>Допустим наша библиотека будет называться <b>fs</b>, тогда команда запишется в виде:
</p><pre>dron:~# ar rc libfs.a f1.o f2.o
</pre>
<p>В результате получим файл <b>libfs.a</b>, в котором будут лежать копии объектых файлов <b>f1.o</b> и <b>f2.o</b>.
 Если файл библиотеки уже существует, то архиватор будет анализировать 
содержимое архива, он добавит новые объектные файлы и заменит старые 
обновленными версиями. Опция <b>c</b> заставляет создавать (от <b>c</b>reate) библиотеку, если ее нет, а опция <b>r</b> (от <b>r</b>eplace) заменяет старые объектные файлы новыми версиями.
</p><p>Пока у нас есть лишь архивный файл <b>libfs.a</b>. Чтобы из него 
сделать полноценную библиотеку объектных файлов надо добавить к этому 
архиву индекс символов, т.е. список вложенных в библиотеку функций и 
переменных, чтобы линковка происходила быстрее. Далается это командой:
</p><pre>ranlib lib<i>имя_библиотеки</i>.a
</pre>
<p>Программа <b>ranlib</b> добавит индекс к архиву и получится 
полноценная статическая библиотека объектных файлов. Стоит отметить, что
 на некоторых системах программа <b>ar</b> автоматически создает индекс, и использование <b>ranlib</b>  не имеет никакого эффекта. Но тут надо быть осторожным при атоматической компиляции библиотеки с помощью файлов <b>makefile</b>, если вы не будете использовать утилиту <b>ranlib</b>,
 то возможно на каких-то системах библиотеки будут создаваться не верно и
 потеряется независимость от платформы. Так что возьмем за правило тот 
факт, что утилиту <b>ranlib</b> надо запускать в любом случае, даже если он нее нет никакого эффекта.
</p><p>Для компиляции нашего основного файла <b>main.c</b> надо сообщить
 компилятору, что надо использовать библиотеки. Чтобы компилятор знал 
где искать библиотеки ему надо сообщить каталог, в котором они 
содержатся и список этих билиотек. Каталог с библиотеками указывается 
ключом <b>-L</b>, в нашем случае библиотека находится в текущем каталоге, значит путь до нее будет в виде точки (<b>-L.</b>). Используемые библиотеки перечисляются через ключ <b>-l</b>, после которого указывается название библиотеки без префикса <b>lib</b> и окончания <b>.a</b>. В нашем случае этот ключ будет выглядеть, как <b>-lfs</b>. Теперь все одной командой:
</p><pre>dron:~# gcc -c main.c
dron:~# gcc main.o -L. -lfs -o rezult
</pre>
<p>Или можно чуть короче:
</p><pre>dron:~# gcc main.c -L. -lfs -o rezult
</pre>
<p>Заметьте, что компилятору нужны библиотеки на этапе создания 
конечного файла, т.е. линковки. В первом случае процесс компиляции 
совершается первой командой, а сборка файла второй командой. Если же мы 
попытаемся подсунуть библиотеку на этапе компиляции, то получим вежливый
 ответ:
</p><pre>dron:~# gcc -c main.c -L. -lfs
gcc: -lfs: linker input file unused since linking not done
</pre>
<p>Что означает, что файлы библиотек не нужны, до процесса линковки. Данная команда создаст лишь файл <b>main.o</b>, который в итоге потом придется собирать отдельно.</p></div><center><hr><a href="http://www.firststeps.ru/linux/r.php?4">Предыдущий Шаг</a> | <a href="http://www.firststeps.ru/linux/r.php?6">Следующий Шаг</a> | <a href="http://www.firststeps.ru/linux/general1.html">Оглавление</a><br>Автор <a href="mailto:kuzinandrey@yandex.ru?SUBJECT=From_part_general#5%27_on_[www.firststeps.ru]">Кузин Андрей</a>.<hr><table align="center" border="0"><tbody><tr><td>
<script type="text/javascript"><!--
google_ad_client = "pub-2721325097469880";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_type = "text_image";
//2007-06-25: Основной
google_ad_channel = "4805213305";
//-->
</script>
<script type="text/javascript" src="www.%D0%9F%D0%95%D0%A0%D0%92%D0%AB%D0%95%20%D0%A8%D0%90%D0%93%D0%98.ru%20::%20%D0%A8%D0%B0%D0%B3%205%20-%20%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5%20%D1%81%D1%82%D0%B0%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%BE%D0%B9%20%D0%B1%D0%B8%D0%B1%D0%BB%D0%B8%D0%BE%D1%82%D0%B5%D0%BA%D0%B8_files/show_ads.js">
</script>
</td></tr></tbody></table>

<script language="JavaScript"><!--
d=document;js=10;a=';r='+escape(d.referrer)
//--></script><script language="JavaScript1.1"><!--
js=11;a+=';j='+navigator.javaEnabled()
//--></script><script language="JavaScript1.2"><!--
js=12;s=screen;a+=';s='+s.width+'*'+s.height
a+=';d='+(s.colorDepth?s.colorDepth:s.pixelDepth)
//--></script><script language="JavaScript1.3"><!--
js=13//--></script><script language="JavaScript"><!--
d.write('<iframe src="http://top.list.ru/counter'+
'?id=23099;js='+js+a+'" height=1 width=1 border=0></iframe>')
if(js>11)d.write('<'+'!-- ')//--></script><iframe src="www.%D0%9F%D0%95%D0%A0%D0%92%D0%AB%D0%95%20%D0%A8%D0%90%D0%93%D0%98.ru%20::%20%D0%A8%D0%B0%D0%B3%205%20-%20%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5%20%D1%81%D1%82%D0%B0%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%BE%D0%B9%20%D0%B1%D0%B8%D0%B1%D0%BB%D0%B8%D0%BE%D1%82%D0%B5%D0%BA%D0%B8_files/counter_002.gif" border="0" height="1" width="1"></iframe><!-- <noscript><iframe
src="http://top.list.ru/counter?js=na;id=23099"
height=1 width=1 alt=""></iframe></noscript><script language="JavaScript"><!--
if(js>11)d.write('--'+'>')
//-->

</center><br><br></body></html>